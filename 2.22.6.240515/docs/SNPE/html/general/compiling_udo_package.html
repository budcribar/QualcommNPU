

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Compiling a UDO package &mdash; Snapdragon Neural Processing Engine SDK</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom_css.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Compiling a UDO package for Windows" href="compiling_udo_package_for_windows.html" />
    <link rel="prev" title="Creating a UDO Package" href="creating_udo_package.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Qualcomm® Neural Processing SDK
          

          
          </a>

          
            
            
              <div class="version">
                v2.22.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="revision_history.html">Revision History</a></li>
<li class="toctree-l1"><a class="reference internal" href="revision_history_windows.html">Revision History - Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="usergroup1.html">Network Models</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="network_layers.html">Supported Network Layers</a></li>
<li class="toctree-l2"><a class="reference internal" href="supported_onnx_ops.html">Supported ONNX Ops</a></li>
<li class="toctree-l2"><a class="reference internal" href="quantized_models.html">Quantized vs Non-Quantized Models</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="usergroup2.html">User-defined Operations</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="udo_overview.html">Overview of UDO</a></li>
<li class="toctree-l3"><a class="reference internal" href="udo_operator_definition.html">Defining a UDO</a></li>
<li class="toctree-l3"><a class="reference internal" href="udo_package_definition.html">Defining a UDO Package</a></li>
<li class="toctree-l3"><a class="reference internal" href="creating_udo_package.html">Creating a UDO Package</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Compiling a UDO package</a></li>
<li class="toctree-l3"><a class="reference internal" href="compiling_udo_package_for_windows.html">Compiling a UDO package for Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="preparing_model_with_udo.html">Preparing a model with UDO</a></li>
<li class="toctree-l3"><a class="reference internal" href="running_model_with_udo.html">Running a model with UDO</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="usergroup3.html">Model Conversion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usergroup5.html">Input Data and Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="usergroup6.html">Tutorials and Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="usergroup10.html">Benchmarking and Accuracy</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="usergroup11.html">Debug Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="limitations.html">Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="appx_ref.html">References</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Qualcomm® Neural Processing SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="usergroup1.html">Network Models</a> &raquo;</li>
        
          <li><a href="usergroup2.html">User-defined Operations</a> &raquo;</li>
        
      <li>Compiling a UDO package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="compiling-a-udo-package">
<h1>Compiling a UDO package<a class="headerlink" href="#compiling-a-udo-package" title="Permalink to this heading">¶</a></h1>
<div class="ui-resizable side-nav-resizable docutils container" id="side-nav">
<div class="docutils container" id="nav-tree">
<div class="docutils container" id="nav-tree-contents">
</div>
</div>
</div>
<div class="docutils container" id="doc-content">
<div class="header docutils container">
</div>
<div class="contents docutils container">
<div class="textblock docutils container">
<p class="rubric" id="introduction">Introduction</p>
<p>This section provides information about compiling UDO packages
for all supported runtimes in Qualcomm® Neural Processing SDK.</p>
<p>As explained in <a class="reference external" href="udo_overview.html">Overview of UDO</a>, a set
of registration and implementation libraries is collectively
referred to as a UDO package. The user has complete control
over building these libraries for their desired runtimes using
compatible tool-chains. Alternatively, Qualcomm® Neural Processing SDK offers tools
and utilities to create and compile a UDO easily. For more
information about the tool used to create a UDO package refer
to <a class="reference external" href="creating_udo_package.html">Creating a UDO package</a>. This
section explains UDO package compilation based on the directory
structure provided by the package generator.</p>
<p class="rubric" id="implementing-a-user-defined-operation">Implementing a User-defined operation</p>
<p>Fundamentally, a UDO is required to be developed using the
set of APIs defined in header files located at
$SNPE_ROOT/include/SNPE/SnpeUdo/. Each runtime may impose
additional requirements and provide options for customizing
the implementation to suit the runtime. Details of the UDO
APIs can be found in the API documentation at
Qualcomm® Neural Processing SDK API.
This section assumes that a UDO package was generated using
the UDO package generator tool described in <a class="reference external" href="creating_udo_package.html">Creating a UDO
package</a> which produces a
partial implementation skeleton based on the UDO
specification configured by the user.</p>
<p class="rubric" id="make-targets-for-package-compilation">Make Targets for Package Compilation</p>
<p>The UDO package generator tool creates a makefile to compile
the package for a specific runtime and target platform
combination. The makefile is intended to provide a simple
interface to compile for platforms that use make natively or
require ndk-build. Using the provided makefile also allows for
per library compilation for various targets.</p>
<p>The general form of each make target is &lt;runtime&gt;_&lt;platform&gt;.
Targets that are only of the form &lt;runtime&gt; include all
possible targets. For instance, running</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>make cpu
</pre></div>
</div>
<p>will compile the CPU for both x86 and Android platforms (arm64-v8a).
A comprehensive table of available
make targets is presented
<a class="reference external" href="compiling_udo_package.html#table-of-make-targets">below</a> .</p>
<p><strong>Note:</strong> Use of the makefile is optional and not required to
generate libraries.</p>
<p><strong>Note:</strong> For all following examples, the displayed artifacts
are for arm64-v8a target.</p>
<p class="rubric" id="implementing-a-udo-for-cpu">Implementing a UDO for CPU</p>
<p>A CPU UDO implementation library based on core UDO APIs is
required to run a UDO package on CPU runtime. The UDO package
generator tool will create a skeleton containing blank
constructs in the required format, but the core logic of
creating and execution of the operation needs to be filled in
by the user. This can be done by completing the implementation
of <code class="docutils literal notranslate"><span class="pre">finalize()</span></code>, <code class="docutils literal notranslate"><span class="pre">execute()</span></code>, and <code class="docutils literal notranslate"><span class="pre">free()</span></code> functions in
the <strong>&lt;OpName&gt;.cpp</strong> file generated by the UDO package
generator tool.</p>
<p>To have good performance and stability, it is required to avoid
heap memory allocation in the completed <code class="docutils literal notranslate"><span class="pre">execute()</span></code> functions.
The heap memory allocation includes but not limited to calling
<code class="docutils literal notranslate"><span class="pre">malloc</span></code>, <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code>, constructing STL container objects
like <code class="docutils literal notranslate"><span class="pre">std::vector</span></code> with default allocator, and adding items
like calling <code class="docutils literal notranslate"><span class="pre">std::vector::push_back</span></code> to STL container objects
with default allocator. Please check
<a class="reference external" href="creating_udo_package.html#avoid-using-heap-memory-allocation">here</a>
for more information.</p>
<p><strong>Note:</strong> One important notion to take into account is that the
Qualcomm® Neural Processing SDK provides tensor data corresponding to all the inputs and
outputs of a UDO not directly but as an opaque pointer.
The UDO implementation is expected to get a handle to the
raw tensor pointers using the methods in the CustomOp operation
object issued by Qualcomm® Neural Processing SDK at the time of
execution. The CPU runtime operates only with floating point
activation tensors. Therefore, CPU UDO implementations should be
implemented to receive and produce only floating point tensors and set
the field data_type in the config file to FLOAT_32. All other data
types will be ignored. Refer to <a class="reference external" href="udo_operator_definition.html">Defining a UDO</a>
for more details.</p>
<p>Compiling and running the UDO package on host is required for
Qualcomm® Neural Processing SDK model quantization tool,
<a class="reference external" href="tools.html#snpe-dlc-quantize">snpe-dlc-quantize</a>. It is
necessary to quantize a model using snpe-dlc-quantize, to run a
UDO layer that has at least one non-float input on the DSP.</p>
<p class="rubric" id="compiling-a-udo-for-cpu-on-host">Compiling a UDO for CPU on host</p>
<p>Steps to compile the CPU UDO implementation library on host x86
platform are as below:</p>
<ol class="arabic">
<li><p>Set the environment variable <code class="docutils literal notranslate"><span class="pre">$SNPE_UDO_ROOT</span></code>.</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export SNPE_UDO_ROOT=&lt;absolute_path_to_SnpeUdo_headers_directory&gt;
</pre></div>
</div>
</li>
<li><p>Run the make instruction below in UDO package directory to compile the UDO package:</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>make cpu_x86
</pre></div>
</div>
</li>
</ol>
<p>The expected artifacts after compiling for Host CPU are</p>
<ul class="simple">
<li><p>The UDO CPU implementation library:
&lt;UDO-Package&gt;/libs/x86-64_linux_clang/libUdo&lt;UDO-Package&gt;ImplCpu.so</p></li>
<li><p>The UDO package registration library:
&lt;UDO-Package&gt;/libs/x86-64_linux_clang/libUdo&lt;UDO-Package&gt;Reg.so</p></li>
</ul>
<p><strong>Note:</strong> The command must be run from the package root.</p>
<p class="rubric" id="compiling-a-udo-for-cpu-on-device">Compiling a UDO for CPU on device</p>
<p>Steps to compile the CPU UDO implementation library on Android
platform are as below:</p>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Set the environment variable <code class="docutils literal notranslate"><span class="pre">$SNPE_UDO_ROOT</span></code>.</div>
</div>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export SNPE_UDO_ROOT=&lt;absolute_path_to_SnpeUdo_headers_directory&gt;
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">$ANDROID_NDK_ROOT</span></code> must be set for the Android NDK build
toolchain.</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export ANDROID_NDK_ROOT=&lt;absolute_path_to_android_ndk_directory&gt;
</pre></div>
</div>
</li>
<li><p>Run the make instruction below in UDO package directory to compile the UDO package:</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>make cpu_android
</pre></div>
</div>
<p>The shared C++ standard library is required for the NDK
build to run. Make sure libc++_shared.so is present on the
device at <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>.</p>
</li>
</ol>
<p>The expected artifacts after compiling for Android CPU are</p>
<ul class="simple">
<li><p>The UDO CPU implementation library:
&lt;UDO-Package&gt;/libs/arm64-v8a/libUdo&lt;UDO-Package&gt;ImplCpu.so</p></li>
<li><p>The UDO package registration library:
&lt;UDO-Package&gt;/libs/arm64-v8a/libUdo&lt;UDO-Package&gt;Reg.so</p></li>
<li><p>A copy of shared standard C++ library:
&lt;UDO-Package&gt;/libs/arm64-v8a/libc++_shared.so</p></li>
</ul>
<p class="rubric" id="implementing-a-udo-for-gpu">Implementing a UDO for GPU</p>
<p>Similar to the CPU runtime, a GPU UDO implementation library
based on core UDO APIs is required to run a UDO package on GPU
runtime. The UDO package generator tool will create a skeleton
containing blank constructs in the required format, but the
core logic of creating and execution of the operation needs to
be filled in by the user. This can be done by completing the
implementation of <code class="docutils literal notranslate"><span class="pre">setKernelInfo()</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;OpName&gt;Operation()</span></code> function, and adding the GPU kernel
implementations in the <strong>&lt;OpName&gt;.cpp</strong> file generated by the
UDO package generator tool.</p>
<p>To have good performance and stability, it is required to avoid
heap memory allocation in the completed <code class="docutils literal notranslate"><span class="pre">&lt;OpName&gt;Operation()</span></code>
functions. The heap memory allocation includes but not limited
to calling <code class="docutils literal notranslate"><span class="pre">malloc</span></code>, <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code>, constructing STL
container objects like <code class="docutils literal notranslate"><span class="pre">std::vector</span></code> with default allocator,
and adding items like calling <code class="docutils literal notranslate"><span class="pre">std::vector::push_back</span></code> to
STL container objects with default allocator. Please check
<a class="reference external" href="creating_udo_package.html#avoid-using-heap-memory-allocation">here</a>
for more information.</p>
<p>Qualcomm® Neural Processing SDK GPU UDO supports 16-bit floating point activations in the
network. Users should expect input/output OpenCL buffer memory
from Qualcomm® Neural Processing SDK GPU UDO to be in 16-bit floating point (or OpenCL
half) data format as the storage type. For increased accuracy,
users may choose to implement internal math operations of the
kernel using 32-bit floating point data, and converting to half
precision when reading input buffers or writing output buffers
from the UDO kernel.</p>
<p><strong>Note:</strong> Qualcomm® Neural Processing SDK provides tensor data corresponding to all the
inputs and outputs of a UDO not directly but as an opaque pointer.
The UDO implementation is expected to convert it to &lt;code&gt;Qnn_Tensor_t&lt;/code&gt;
which holds OpenCL memory pointer for tensor.</p>
<p class="rubric" id="compiling-a-udo-for-gpu-on-device">Compiling a UDO for GPU on device</p>
<p>Steps to compile the GPU UDO implementation library on Android
platform are as below:</p>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Set the environment variable <code class="docutils literal notranslate"><span class="pre">$SNPE_UDO_ROOT</span></code>.</div>
</div>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export SNPE_UDO_ROOT=&lt;absolute_path_to_SnpeUdo_headers_directory&gt;
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">$ANDROID_NDK_ROOT</span></code> must be set for the Andorid NDK build
toolchain.</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export ANDROID_NDK_ROOT=&lt;absolute_path_to_android_ndk_directory&gt;
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">$CL_LIBRARY_PATH</span></code> must be set for the libOpenCL.so
library location.</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export CL_LIBRARY_PATH=&lt;absolute_path_to_OpenCL_library&gt;
</pre></div>
</div>
<p>The OpenCL shared library is not distributed as part of Qualcomm® Neural Processing SDK.</p>
</li>
<li><p>Run the make instruction below in UDO package directory to compile the UDO package:</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>make gpu_android
</pre></div>
</div>
</li>
</ol>
<p><strong>Note:</strong> The shared OpenCL library is target specific. It
should be discoverable in <code class="docutils literal notranslate"><span class="pre">CL_LIBRARY_PATH</span></code>.</p>
<p>The expected artifacts after compiling for Android GPU are</p>
<ul class="simple">
<li><p>The UDO GPU implementation library:
&lt;UDO-Package&gt;/libs/arm64-v8a/libUdo&lt;UDO-Package&gt;ImplGpu.so</p></li>
<li><p>The UDO package registration library:
&lt;UDO-Package&gt;/libs/arm64-v8a/libUdo&lt;UDO-Package&gt;Reg.so</p></li>
<li><p>A copy of shared standard C++ library:
&lt;UDO-Package&gt;/libs/arm64-v8a/libc++_shared.so</p></li>
</ul>
<p class="rubric" id="implementing-a-udo-for-dsp-v65-and-v66">Implementing a UDO for DSP V65 and V66</p>
<p>Qualcomm® Neural Processing SDK utilizes Qualcomm® AI Direct SDK to run UDO layers on DSP. Therefore, a DSP
implementation library based on Qualcomm® AI Direct SDK APIs is required to run
a UDO package on DSP runtime. The UDO package generator tool
will create the template file <strong>&lt;OpName&gt;.cpp</strong> and the user
will need to implement the execution logic in the
<code class="docutils literal notranslate"><span class="pre">&lt;OpName&gt;_executeOp()</span></code> function in the template file.</p>
<p>To have good performance and stability, it is required to avoid
heap memory allocation in the completed <code class="docutils literal notranslate"><span class="pre">&lt;OpName&gt;_executeOp()</span></code>
functions. The heap memory allocation includes but not limited
to calling <code class="docutils literal notranslate"><span class="pre">malloc</span></code>, <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code>, constructing STL
container objects like <code class="docutils literal notranslate"><span class="pre">std::vector</span></code> with default allocator,
and adding items like calling <code class="docutils literal notranslate"><span class="pre">std::vector::push_back</span></code> to
STL container objects with default allocator. Please check
<a class="reference external" href="creating_udo_package.html#avoid-using-heap-memory-allocation">here</a>
for more information.</p>
<p>Qualcomm® Neural Processing SDK UDO provides the support for multi-threading of the
operation using worker threads, Hexagon Vector Extensions (HVX)
code and VTCM support.</p>
<p>The DSP runtime only propagates unsigned 8-bit activation
tensors between the network layers. But it has the ability to
de-quantize data to floating point if required. Therefore users
developing DSP kernels can expect either UINT_8 or FLOAT_32
activation tensors in and out of the operation, and thus can
set the field data_type in the config file to one of these two
settings. Refer to <a class="reference external" href="udo_operator_definition.html">Defining a
UDO</a> for more details.</p>
<p class="rubric" id="compiling-a-udo-for-dsp-v65-and-v66-on-device">Compiling a UDO for DSP V65 and V66 on device</p>
<p>This Qualcomm® Neural Processing SDK release supports building UDO DSP implementation
libraries using Hexagon-SDK 3.5.x.</p>
<ol class="arabic">
<li><p>Set the environment variables <code class="docutils literal notranslate"><span class="pre">$SNPE_UDO_ROOT</span></code></p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export SNPE_UDO_ROOT=&lt;absolute_path_to_SnpeUdo_headers_directory&gt;
</pre></div>
</div>
</li>
<li><p>Hexagon-SDK needs to be installed and set up. For details,
follow the setup instructions on
<code class="docutils literal notranslate"><span class="pre">$HEXAGON_SDK_ROOT/docs/readme.html</span></code> page, where
<code class="docutils literal notranslate"><span class="pre">$HEXAGON_SDK_ROOT</span></code> is the location of the Hexagon-SDK
installation. Make sure <code class="docutils literal notranslate"><span class="pre">$HEXAGON_SDK_ROOT</span></code> is set to use
the Hexagon-SDK build toolchain. Also set
<code class="docutils literal notranslate"><span class="pre">$HEXAGON_TOOLS_ROOT</span></code> and <code class="docutils literal notranslate"><span class="pre">$SDK_SETUP_ENV</span></code></p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export HEXAGON_SDK_ROOT=&lt;path to hexagon sdk installation&gt;
export HEXAGON_TOOLS_ROOT=$HEXAGON_SDK_ROOT/tools/HEXAGON_Tools/8.3.07
export ANDROID_NDK_ROOT=&lt;path to Android NDK installation&gt;
export SDK_SETUP_ENV=Done
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">$ANDROID_NDK_ROOT</span></code> must be set for the Andorid NDK build
toolchain.</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export ANDROID_NDK_ROOT=&lt;absolute_path_to_android_ndk_directory&gt;
</pre></div>
</div>
</li>
<li><p>Run the make instruction below in UDO package directory to compile the UDO DSP
implementation library:</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>make dsp
</pre></div>
</div>
</li>
</ol>
<p>The expected artifacts after compiling for DSP are</p>
<ul class="simple">
<li><p>The UDO DSP implementation library:
&lt;UDO-Package&gt;/libs/dsp_&lt;dsp_arch_type&gt;/libUdo&lt;UDO-Package&gt;ImplDsp.so</p></li>
<li><p>The UDO package registration library:
&lt;UDO-Package&gt;/libs/arm64-v8a/libUdo&lt;UDO-Package&gt;Reg.so</p></li>
</ul>
<p><strong>Note:</strong> The command must be run from the package root. dsp_v60 folder is created for all aarchs which are less than v68.</p>
<p class="rubric" id="implementing-a-udo-for-dsp-v68-or-later">Implementing a UDO for DSP V68 or later</p>
<p>Qualcomm® Neural Processing SDK utilizes Qualcomm® AI Direct SDK to run UDO layers on DSP v68 or later.
Therefore, a DSP implementation library based on Qualcomm® AI Direct SDK APIs
is required to run a UDO package on DSP runtime. The UDO
package generator tool will create the template file
<strong>&lt;OpName&gt;ImplLibDsp.cpp</strong> and the user will need to implement
the execution logic in the <code class="docutils literal notranslate"><span class="pre">&lt;OpName&gt;Impl()</span></code> function in the
template file.</p>
<p>To have good performance and stability, it is required to avoid
heap memory allocation in the completed <code class="docutils literal notranslate"><span class="pre">&lt;OpName&gt;Impl()</span></code>
functions. The heap memory allocation includes but not limited
to calling <code class="docutils literal notranslate"><span class="pre">malloc</span></code>, <code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">new</span></code>, constructing STL
container objects like <code class="docutils literal notranslate"><span class="pre">std::vector</span></code> with default allocator,
and adding items like calling <code class="docutils literal notranslate"><span class="pre">std::vector::push_back</span></code> to
STL container objects with default allocator. Please check
<a class="reference external" href="creating_udo_package.html#avoid-using-heap-memory-allocation">here</a>
for more information.</p>
<p>Qualcomm® Neural Processing SDK UDO provides the support for Hexagon Vector Extensions
(HVX) code and cost based scheduling.</p>
<p>The DSP runtime propagates unsigned 8-bit or unsigned 16-bit
activation tensors between the network layers. But it has the
ability to de-quantize data to floating point if required.
Therefore users developing DSP kernels can expect either
UINT_8, UINT_16 or FLOAT_32 activation tensors in and out of
the operation, and thus can set the field data_type in the
config file to one of these three settings. Refer to Qualcomm® AI Direct SDK
for more details.</p>
<p class="rubric" id="compiling-a-udo-for-dsp-v68-or-later-on-device">Compiling a UDO for DSP_V68 or later on device</p>
<p>This Qualcomm® Neural Processing SDK release supports building UDO DSP implementation
libraries using Hexagon-SDK 4.x and Qualcomm® AI Direct SDK.</p>
<ol class="arabic">
<li><p>Set the environment variables <code class="docutils literal notranslate"><span class="pre">$SNPE_UDO_ROOT</span></code></p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export SNPE_UDO_ROOT=&lt;absolute_path_to_SnpeUdo_headers_directory&gt;
</pre></div>
</div>
</li>
<li><p>Hexagon-SDK 4.0+ needs to be installed and set up. For
Hexagon-SDK details, follow the setup instructions on
<code class="docutils literal notranslate"><span class="pre">$HEXAGON_SDK4_ROOT/docs/readme.html</span></code> page, where
<code class="docutils literal notranslate"><span class="pre">$HEXAGON_SDK4_ROOT</span></code> is the location of the Hexagon-SDK
installation. Make sure <code class="docutils literal notranslate"><span class="pre">$HEXAGON_SDK4_ROOT</span></code> is set to use
the Hexagon-SDK build toolchain. Also, set
<code class="docutils literal notranslate"><span class="pre">$HEXAGON_TOOLS_ROOT</span></code> and <code class="docutils literal notranslate"><span class="pre">$SDK_SETUP_ENV</span></code>. Additionally,
we need an extracted Qualcomm® AI Direct SDK (no need of Qualcomm® AI Direct SDK setup) for
building the libraries. For Qualcomm® AI Direct SDK details, refer to the
Qualcomm® AI Direct SDK documentation at <code class="docutils literal notranslate"><span class="pre">$QNN_SDK_ROOT/docs/QNN/index.html</span></code> page,
where <code class="docutils literal notranslate"><span class="pre">$QNN_SDK_ROOT</span></code> is the location of the Qualcomm® AI Direct SDK
installation. Set the <code class="docutils literal notranslate"><span class="pre">$QNN_SDK_ROOT</span></code> to the unzipped
Qualcomm® AI Direct SDK location.</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export HEXAGON_SDK_ROOT=&lt;path to hexagon sdk installation&gt;
export HEXAGON_SDK4_ROOT=&lt;path to hexagon sdk 4.x installation&gt;
export HEXAGON_TOOLS_ROOT=$HEXAGON_SDK_ROOT/tools/HEXAGON_Tools/8.4.09
export QNN_SDK_ROOT=&lt;path to QNN sdk installation&gt;
export ANDROID_NDK_ROOT=&lt;path to Android NDK installation&gt;
export SDK_SETUP_ENV=Done
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">$ANDROID_NDK_ROOT</span></code> must be set for the Andorid NDK build
toolchain.</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>export ANDROID_NDK_ROOT=&lt;absolute_path_to_android_ndk_directory&gt;
</pre></div>
</div>
</li>
<li><p>Run the make instruction below in UDO package directory to compile the UDO DSP
implementation library:</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>make dsp
</pre></div>
</div>
</li>
<li><p>Run the make instruction below in UDO package directory to generate a library for
offline cache generation:</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>make dsp_x86 X86_CXX=&lt;path_to_x86_64_clang&gt;
</pre></div>
</div>
</li>
<li><p>Run the make instruction below in UDO package directory to generate a library for <strong>Android ARM architecture</strong>:</p>
<div class="highlight-fragment notranslate"><div class="highlight"><pre><span></span>make dsp_aarch64
</pre></div>
</div>
<p><strong>Note:</strong> This should only be run on linux based devices. This should not be run for Windows based devices.</p>
</li>
</ol>
<p>The expected artifacts after compiling for DSP are</p>
<ul class="simple">
<li><p>The UDO DSP implementation library:
&lt;UDO-Package&gt;/libs/dsp_v68/libUdo&lt;UDO-Package&gt;ImplDsp.so</p></li>
<li><p>The UDO package registration library:
&lt;UDO-Package&gt;/libs/arm64-v8a/libUdo&lt;UDO-Package&gt;Reg.so</p></li>
</ul>
<p>The expected artifact after compiling for offline cache
generation is</p>
<ul class="simple">
<li><p>The UDO DSP implementation library:
&lt;UDO-Package&gt;/libs/x86-64_linux_clang/libUdo&lt;UDO-Package&gt;ImplDsp.so</p></li>
</ul>
<p>The expected artifact after compiling for Android ARM
architecture is</p>
<ul class="simple">
<li><p>The UDO DSP implementation library:
&lt;UDO-Package&gt;/libs/arm64-v8a/libUdo&lt;UDO-Package&gt;ImplDsp_AltPrep.so</p></li>
</ul>
<p>Note: The command must be run from the package root.</p>
<p class="rubric" id="table-of-make-targets">Table of Make Targets</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 21%" />
<col style="width: 24%" />
<col style="width: 29%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Make Target</p></th>
<th class="head"><p>Runtime</p></th>
<th class="head"><p>Platform</p></th>
<th class="head"><p>Misc.</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>all</p></td>
<td><p>CPU, GPU, DSP</p></td>
<td><p>x86, arm64-v8a</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>all_x86</p></td>
<td><p>CPU</p></td>
<td><p>x86</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>all_android</p></td>
<td><p>CPU, GPU, DSP</p></td>
<td><p>arm64-v8a</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>reg</p></td>
<td></td>
<td><p>x86, arm64-v8a</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>reg_x86</p></td>
<td></td>
<td><p>x86</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>reg_android</p></td>
<td></td>
<td><p>arm64-v8a</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>cpu</p></td>
<td><p>CPU</p></td>
<td><p>x86, arm64-v8a</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>cpu_x86</p></td>
<td><p>CPU</p></td>
<td><p>x86</p></td>
<td><p>Same as all_x86</p></td>
</tr>
<tr class="row-even"><td><p>cpu_android</p></td>
<td><p>CPU</p></td>
<td><p>arm64-v8a</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>gpu</p></td>
<td><p>GPU</p></td>
<td><p>arm64-v8a</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>gpu_android</p></td>
<td><p>GPU</p></td>
<td><p>arm64-v8a</p></td>
<td><p>Same as gpu</p></td>
</tr>
<tr class="row-odd"><td><p>dsp</p></td>
<td><p>DSP</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>dsp_android</p></td>
<td><p>DSP</p></td>
<td></td>
<td><p>Same as dsp</p></td>
</tr>
<tr class="row-odd"><td><p>dsp_x86</p></td>
<td><p>DSP</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p>dsp_aarch64</p></td>
<td><p>DSP</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Note:</strong> By default, compiling for a runtime additionally
compiles the corresponding registration library</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="compiling_udo_package_for_windows.html" class="btn btn-neutral float-right" title="Compiling a UDO package for Windows" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="creating_udo_package.html" class="btn btn-neutral float-left" title="Creating a UDO Package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020-2023, Qualcomm Technologies, Inc..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>