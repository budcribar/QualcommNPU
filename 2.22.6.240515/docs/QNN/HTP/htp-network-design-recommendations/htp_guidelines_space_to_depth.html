

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Use Space-to-depth transformation where possible &mdash; Qualcomm® AI Engine Direct</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom_css.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/collapsible-lists/css/tree_view.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/collapsible-lists/js/CollapsibleLists.compressed.js"></script>
        <script src="../../_static/collapsible-lists/js/apply-collapsible-lists.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Reducing TCM requirements for performance and functionality" href="htp_guidelines_tcm_requirements.html" />
    <link rel="prev" title="Avoid low depth Activations (Network examples)" href="htp_guidelines_low_depth_activation_more_examples.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Qualcomm® AI Engine Direct
          

          
          </a>

          
            
            
              <div class="version">
                v2.22.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../general/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/backend.html">Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/op_packages.html">Op Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/tools.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/converters.html">Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/quantization.html">Quantization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/benchmarking.html">Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/operations.html">Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Qualcomm® AI Engine Direct</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../general/backend.html">Backend</a> &raquo;</li>
        
          <li><a href="../../general/htp/htp_backend.html">HTP</a> &raquo;</li>
        
      <li>Use Space-to-depth transformation where possible</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="use-space-to-depth-transformation-where-possible">
<h1>Use Space-to-depth transformation where possible<a class="headerlink" href="#use-space-to-depth-transformation-where-possible" title="Permalink to this heading">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#convolution" id="id1">Convolution</a></p></li>
<li><p><a class="reference internal" href="#elementwise-operations" id="id2">Elementwise Operations</a></p></li>
<li><p><a class="reference internal" href="#reshaping-data" id="id3">Reshaping Data</a></p></li>
</ul>
</div>
<div class="section" id="convolution">
<h2><a class="toc-backref" href="#id1">Convolution</a><a class="headerlink" href="#convolution" title="Permalink to this heading">¶</a></h2>
<p>If a low input channel activation goes through a space-to-depth transformation, we can make
a convolution equivalent by doing the equivalent space-to-depth transformation in the weights.
For example, if we have original activations that are 1024x1024x8, we can run them through a
space-to-depth transformation with 2x2 size.  The resulting activations would be 512x512x32,
which matches better with the hardware functionality.  We would then need to take the weights
and modify them to match the new data arrangement.  If the original weights were 3x3x8x8
(h*w*n_I*n_o), we could do a similar space-to-depth transformation, replicating the weights
four times to match the new location.  We need to round up to handle all overlap, so we would
end up in this case with weights that were sized 2x2x32x32.</p>
<div class="figure align-center" id="figure-9-figure">
<a class="reference internal image-reference" href="../../_static/resources/htp_guidelines_fig_9.png"><img alt="../../_static/resources/htp_guidelines_fig_9.png" src="../../_static/resources/htp_guidelines_fig_9.png" style="width: 800px;" /></a>
</div>
<p class="centered">
<strong><strong>Transformations to convolution to increase channel use</strong></strong></p><p>When several convolutions are sequential, the back-to-back depth-to-space and space-to-depth
can be eliminated.  Also, space-to-depth followed by convolution is a way to implement convolution
with stride, and convolution followed by depth-to-space is a way to implement “transpose convolution
with stride”.
For some models, the space-to-depth and smaller filter size may be able to be modified in the
original model and trained with the structure in-place.  Otherwise, the description above should
yield exact results to the original strategy.</p>
</div>
<div class="section" id="elementwise-operations">
<h2><a class="toc-backref" href="#id2">Elementwise Operations</a><a class="headerlink" href="#elementwise-operations" title="Permalink to this heading">¶</a></h2>
<p>If both inputs of an elementwise operator have had the same space-to-depth operation applied to
them, they can be operated on with the same operator.</p>
</div>
<div class="section" id="reshaping-data">
<h2><a class="toc-backref" href="#id3">Reshaping Data</a><a class="headerlink" href="#reshaping-data" title="Permalink to this heading">¶</a></h2>
<p>It is common to see low channel convolution near the output of some networks, particularly ones
that do image processing.  The data arrangement is the same for an image with low channels, or an
image that has had a width-to-depth transformation.  Consider using a width-to-depth transformation
to increase the channels and then treating the output as the desired original low-channel and wider
image.  For example, a 1024x1024x3 could be computed as 1024x256x12, and then the output used as
1024x1024x3.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="htp_guidelines_tcm_requirements.html" class="btn btn-neutral float-right" title="Reducing TCM requirements for performance and functionality" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="htp_guidelines_low_depth_activation_more_examples.html" class="btn btn-neutral float-left" title="Avoid low depth Activations (Network examples)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020-2024, Qualcomm Technologies, Inc..

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>